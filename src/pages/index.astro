---
import Base from '../layouts/Base.astro';
import Logo from '../components/Logo.astro';
import { SearchBox } from '../components/SearchBox';
import { getCollection } from 'astro:content';

const pages = await getCollection('wiki');
const pageData = pages
  .map(p => ({
    slug: p.slug,
    title: p.data.title,
    description: p.data.description,
    tags: p.data.tags,
    date: p.data.date
  }))
  .sort((a, b) => {
    if (!a.date && !b.date) return 0;
    if (!a.date) return 1;
    if (!b.date) return -1;
    return b.date.getTime() - a.date.getTime();
  });

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', { 
    month: 'short', 
    day: 'numeric',
    year: 'numeric',
    timeZone: 'UTC'
  });
};
---

<Base title="Home">
  <!-- Hero section - centered like Grokpedia -->
  <div class="min-h-[60vh] flex flex-col items-center justify-center px-4 py-16">
    <div class="w-full max-w-xl text-center">
      <h1 class="mb-4">
        <Logo size="xl" />
      </h1>
      <p class="text-text-secondary text-lg mb-10">
        Technical AI/ML reference for practitioners
      </p>
      
      <!-- Search - prominent like Grokpedia -->
      <SearchBox client:load pages={pageData} />
    </div>
  </div>

  <!-- Topics section -->
  <section class="max-w-2xl mx-auto px-4 pb-20">
    <h2 class="text-xs font-medium text-text-secondary mb-4 uppercase tracking-widest">
      Recent Topics
    </h2>
    <div class="divide-y divide-border">
      {pageData.map(page => (
        <a 
          href={`/${page.slug}`}
          class="group block py-4 hover:bg-bg-secondary/30 -mx-4 px-4 transition-colors"
        >
          <div class="flex items-baseline justify-between gap-4 mb-1">
            <div class="font-medium group-hover:underline">
              {page.title}
            </div>
            {page.date && (
              <div class="text-xs text-text-secondary shrink-0">
                {formatDate(page.date)}
              </div>
            )}
          </div>
          <div class="text-sm text-text-secondary">
            {page.description}
          </div>
        </a>
      ))}
    </div>

    <!-- Footer links -->
    <div class="flex gap-6 text-sm text-text-secondary mt-8 pt-6 border-t border-border">
      <a href="/browse" class="hover:text-text transition-colors">All topics</a>
      <a href="/tags" class="hover:text-text transition-colors">Browse by tag</a>
    </div>
  </section>
</Base>
